<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>オンライン運転体験 | 東大プラレーラーズ五月祭2020</title>
    <link rel="stylesheet" href="style.css" type="text/css">
    <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap" rel="stylesheet">
    <link href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" rel="stylesheet">
  </head>
  <body>
    <header>
      <h1>オンライン運転体験</h1>
    </header>
    <div id="message_area">
      <!-- https://copypet.jp/692/ より -->
      <div class="input_text">
        <input type="text" id="pw_input" placeholder="パスワードを入力">
        <i class="fas fa-subway"　aria-hidden="true"></i>
      </div>
      <a href="#" class="input_button" id="pw_send">運転をはじめる</a>
    </div>
    <div id="content">
      <div id="controller">
        <div id="movie"></div>
        <div id="mascon_area">
          <input type="range" id="speed" value="0" min="0" max="255" step="1">
        </div>
      </div>
    </div>
    
    
  </body>
</html>

<script>
  // var ws = new WebSocket('wss://yt8z40ew59.execute-api.us-east-1.amazonaws.com/dev');  // サーバ通信用のwebsocket
  var speed = 0;

  // 【スピードをサーバに送信】0.4secおきに送信する
  var timer;
  var isTimerOn = false;
  document.getElementById('speed').addEventListener('input', function(){
    if (isTimerOn == false) {
      timer = setTimeout(function(){
        speed = document.getElementById('speed').value;
        // ws.send(JSON.stringify({"speed": speed}));
        console.log('send speed ' + speed);
        isTimerOn = false;
      }, 400);  // ハンドルを動かした0.4sec後に送信
      isTimerOn = true;
    }
  });

  //【PW照合関係】
  

  //【サイズ調整】
  window.onload = controller_resize;  // ロード時にレイアウトを調整
  window.onresize = controller_resize; // ウィンドウサイズ変更時にレイアウトを調整
  function controller_resize() {
    // div controller のサイズ調整
    var content_width = document.getElementById('content').clientWidth;
    var content_height = document.getElementById('content').clientHeight;
    var controller = document.getElementById('controller')
    if ( content_width / content_height > 64/27 ) {  // controllerより横長の表示領域
      controller.style.height = '100%';
      controller.style.width = content_height * 64/27 + 'px';
    } else {  // controllerより縦長の表示領域
      controller.style.width = '100%';
      controller.style.height = content_width * 27/64 + 'px';
    }
    // マスコンハンドルのサイズ調整
    var area_width  = document.getElementById('mascon_area').clientWidth;
    var area_height = document.getElementById('mascon_area').clientHeight;
    var mascon = document.getElementById('speed');
    mascon.style.width = area_height * 0.667 + 'px';  // 長さ
    mascon.style.marginTop = area_height * 0.5 - 5 + 'px';  // 縦位置を調整
    mascon.style.marginLeft = - (mascon.clientWidth - area_width) / 2 + 'px';  // 横位置ははみ出している分左へ
  }
</script>